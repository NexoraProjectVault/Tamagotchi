---
name: Service Health Check

on:
  schedule:
    - cron: "*/12 * * * *"

jobs:
  health_check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Services
        run: |
          services=(
            "https://pet-service-qmej.onrender.com"
            "https://user-service-mbyd.onrender.com"
            "https://tamagotchi-n0y6.onrender.com"
            "https://data-tracking-service.onrender.com"
            "https://task-service-g67r.onrender.com"
          )
          
          for service in "${services[@]}"; do
            echo "Checking $service..."
            while true; do
              if curl -f "$service" \
                --max-time 10 \
                --silent \
                --output /dev/null; then
                echo "✓ $service is healthy at $(date)"
                break
              else
                echo "✗ $service unhealthy, retrying in 5 seconds..."
                sleep 5
              fi
            done
          done
          
          echo "All services are healthy!"
